# A basic .muttrc for use with Gmail

set from = "robin.jarry@6wind.com"
set realname = "Robin Jarry"
set smtp_url = "smtps://$from@smtp.gmail.com/"
set hostname = "6wind.com"
source ~/.muttrc.local

set imap_user = $from
set imap_pass = $smtp_pass
unset imap_passive
set imap_idle
set imap_keepalive = 300
set timeout = 30
set mail_check = 10

set ts_enabled = yes
set ts_status_format = "6WIND Mutt [%n new messages]"

set folder = "imaps://imap.gmail.com/"
set spoolfile = "+INBOX"
set postponed = "+[Gmail]/Drafts"
set mbox = "+[Gmail]/All Mail"

mailboxes +INBOX

set editor = "vim +/^$ ++1"
set edit_headers

set header_cache = "~/.cache/mutt/headers"
set message_cachedir = "~/.cache/mutt/messages"
set header_cache_backend = "tokyocabinet"
set certificate_file = "~/.mutt/certificates"

set attach_charset = "ascii:utf-8"
set assumed_charset = "ascii:utf-8"
set send_charset = "ascii:utf-8"

set hide_thread_subject = no
set sort = reverse-threads
set sort_re
set reply_regexp = "^(([Rr][Ee]?(\[[0-9]+\])?: *)?(\[[^]]+\] *)?)*"
set date_format = "%a %F %R"
set index_format = "%Z  %-20.20L  %s%* %<[y?%<[d?%[      %H:%M]&%[     %d %b]>&%[%d %b %Y]>"
set attribution = "%{%F}, %n:"
set fast_reply
set autoedit
set quote_regexp="^([ \t]*[>%:|])+"
set sleep_time = 0

set envelope_from
unset record			# do not record sent mail, gmail does that
set nomove			# do not move to $mbox when an email is read
set include			# quote messages when replying
set nobeep			# quiet
set nobeep_new			# quiet
set delete
set noconfirmappend
set quit
set nomark_old			# read/new is good enough for me
set nowait_key			# shut up, mutt

# look and feel
set pager_index_lines = 8
set pager_context = 5
set pager_stop			# do not skip to next when reaching end of email
set menu_scroll
set smart_wrap
set tilde
unset markers

set reflow_text			# reflow format=flowed emails in pager
set reflow_wrap = 72		# format=flowed emails reflow width
set xterm_set_titles		# pretty window title

set sidebar_visible = no
set sidebar_width = 15
set sidebar_short_path = yes
bind index,pager \Cp sidebar-prev
bind index,pager \Cn sidebar-next
bind index,pager \Co sidebar-open
bind index,pager \Cb sidebar-toggle-visible

alternative_order text/plain text/html *
auto_view text/html

ignore *
unignore From:
unignore To:
unignore Subject:
unignore Date:
unignore CC:
unignore BCC:
hdr_order Date: From: To: CC: BCC: Subject: \
	Organization: User-Agent: X-Mailer: Message-ID:

set query_command = "ssh dio-ext bin/mutt-ldap-search.py '%s'"

bind editor <Tab> complete-query
bind editor ^T complete
bind editor <space> noop
bind editor <space> noop
bind pager <up> previous-line
bind pager <down> next-line
bind pager g noop
bind pager gg top
bind pager G bottom
bind index q noop
bind index x noop
bind index g noop
bind index gg first-entry
bind index G last-entry
bind generic,index,pager N search-opposite
bind index,pager R group-reply
macro index,pager a "<save-message>=[Gmail]/All Mail<enter><change-folder>!<enter>" "Archive"

macro index,pager <tab> "<change-folder>!<enter>" "refresh inbox"
macro index,pager <f5> "<change-folder>!<enter>" "refresh inbox"
macro index,pager gs "<change-folder>=[Gmail]/Sent Mail<enter>" "go to sent mail"
macro index,pager ga "<change-folder>=[Gmail]/All Mail<enter>" "go to archive"

# Colours for items in the index
color search white color21
color status color242 color233
color indicator default color235
color index_date blue default
color index_flags brightcyan default ~N		# new
color index_flags red default ~D		# deleted
color index_flags brightyellow default ~F	# flagged
color index_author cyan default .
color tree  red default
color tilde red default

color hdrdefault cyan default
color header brightwhite default "^(From|Subject):"
color attachment brightyellow default
color quoted color34 default
color quoted1 color166 default
color quoted2 color25 default
color quoted3 color34 default
color quoted4 color166 default
color quoted5 color25 default
color signature color27 default

# Highlights inside the body of a message.
message-hook . "uncolor body *"
message-hook . "color body yellow  default '(http|https|ftp)://[^ \"\t\r\n]*'"
message-hook . "color body yellow  default 'mailto:[-a-z_0-9.]+@[-a-z_0-9.]+'"
message-hook . "color body yellow  default '[-a-z_0-9.%$]+@[-a-z_0-9.]+\\.[-a-z][-a-z]+'"
message-hook . "color body green default ' [;:]-*[D)>(<|]'"

# patches
message-hook '~h "Subject: .*\\[PATCH"' "color body magenta default '^diff --git .*$'"
message-hook '~h "Subject: .*\\[PATCH"' "color body magenta default '^index [a-f0-9].*$'"
message-hook '~h "Subject: .*\\[PATCH"' "color body magenta default '^--- .*$'"
message-hook '~h "Subject: .*\\[PATCH"' "color body magenta default '^[\+]{3} .*$'"
message-hook '~h "Subject: .*\\[PATCH"' "color body cyan    default '^@@ [^@]+ @@'"
message-hook '~h "Subject: .*\\[PATCH"' "color body red     default '^-[^-].*$'"
message-hook '~h "Subject: .*\\[PATCH"' "color body green   default '^[\+][^\+].*$'"
message-hook '~h "Subject: .*\\[PATCH"' "color body red     default '^-$'"
message-hook '~h "Subject: .*\\[PATCH"' "color body green   default '^[\+]$'"
